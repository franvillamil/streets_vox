setwd("~/Google Drive/Academic/Projects/streets_vox")
options(stringsAsFactors = FALSE)
library(tidyverse)
library(stringr)

codefile = "data/CIS2760/ES2760"
datafile = "data/CIS2760/DA2760"

guide = c("ESTU", "1-4",
  "CUES", "5-9",
  "CCAA", "10-11",
  "PROV", "12-13",
  "MUN", "14-16",
  "TAMUNI", "17",
  "AREA", "18",
  "DISTR", "19-20",
  "SECCION", "21-23",
  "ENTREV", "24-27",
  "P1", "28",
  "P2", "29",
  "P3", "30",
  "P401", "31",
  "P402", "32",
  "P403", "33",
  "P404", "34",
  "P501", "35-36",
  "P502", "37-38",
  "P601", "39",
  "P602", "40",
  "P6A", "41-42",
  "P701", "43-44",
  "P702", "45-46",
  "P801", "47-48",
  "P802", "49-50",
  "P9", "51",
  "P10", "52-53",
  "P10A", "54-55",
  "P11", "56-57",
  "P11A", "58-59",
  "P12", "60",
  "P12A", "61",
  "P1301", "62",
  "P1302", "63",
  "P1303", "64",
  "P1304", "65",
  "P1305", "66",
  "P1306", "67",
  "P13A", "68",
  "P1401", "69-70",
  "P14A01", "71",
  "P1402", "72-73",
  "P14A02", "74",
  "P1403", "75-76",
  "P14A03", "77",
  "P15-P17", "78-85",
  "P18", "86",
  "P18A", "87",
  "P1901", "88",
  "P1902", "89",
  "P1903", "90",
  "P1904", "91",
  "P1905", "92",
  "P2001-P22", "93-110",
  "P23", "111",
  "P23A", "112",
  "P23B", "113",
  "P23C", "114",
  "P24", "115",
  "P24A", "116",
  "P2501", "117",
  "P2502", "118",
  "P2503", "119",
  "P2504", "120",
  "P2505", "121",
  "P2506", "122",
  "P26", "123",
  "P26A", "124",
  "P27", "125",
  "P27A", "126",
  "P28", "127",
  "P29", "128-129",
  "P29A", "130-131",
  "P30-P35", "132-150",
  "P36-P38", "151-153",
  "P38A", "154-155",
  "P39", "156-157",
  "P40", "158",
  "P40A", "159-160",
  "P41", "161-162",
  "P42-P48", "163-176",
  "P49", "177",
  "P50", "178-180",
  "P51", "181-182",
  "P52", "183",
  "P53", "184",
  "P54", "185-186",
  "P55-P55A-P56", "187-189",
  "P56A", "190-191",
  "P57", "192-193",
  "P58-P58A", "194-195",
  "P59", "196",
  "P60", "197-199",
  "P61-P61A", "200-201",
  "P62", "202-203",
  "P63", "204",
  "P6401", "205",
  "P6402", "206",
  "P6403", "207",
  "P6404", "208",
  "P6501", "209-211",
  "P6502", "212-214",
  "P6503", "215-217",
  "P6504", "218-220",
  "P6505", "221-223",
  "P66", "224",
  "P67", "225",
  "P68", "226",
  "P69", "227",
  "P7001", "228",
  "P7002", "229",
  "I1", "230-232",
  "I2", "233-235",
  "I3", "236-238",
  "I4", "239-241",
  "I5", "242-244",
  "I6", "245-247",
  "I7", "248-250",
  "I8", "251-253",
  "I9", "254-256",
  "E101", "257-258",
  "E102", "259-260",
  "E103", "261-262",
  "E2", "263",
  "E3", "264-266",
  "E4", "267",
  "C1", "268",
  "C1A", "269-270",
  "C2", "271",
  "C2A", "272",
  "C2B", "273-274",
  "C3", "275",
  "FINAL", "276-277",
  "PESO", "279-284",
  "RECUERDO", "285-286",
  "OCUPAPAD", "287-288",
  "ESTUDIOS", "289",
  "OCUPA", "290-291",
  "CONDICION", "292-293",
  "ESTATUS", "294")
# Create df with question and fixed width value
guide_df = as.data.frame(matrix(guide, ncol = 2, byrow = TRUE))
names(guide_df) = c("q", "fw_raw")
# Extract first value of fixed width
guide_df$fw_int = as.integer(gsub("(\\d*).*", "\\1", guide_df$fw_raw))
# Get final number (last 3)
total_chr = as.integer(str_sub(guide_df$fw_raw[nrow(guide_df)], -3L, -1L))
# Get number of columns
guide_df$fw = c(diff(guide_df$fw_int),
  total_chr - guide_df$fw_int[nrow(guide_df)])

## Get data
data = read.fwf(datafile, widths = guide_df$fw, col.names = guide_df$q)

## SAVE
write.csv(data, "data/CIS2760/CIS2760.csv", row.names = FALSE)
